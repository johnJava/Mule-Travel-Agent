<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<mule-configuration xmlns="http://www.mulesoft.com/tooling/messageflow" name="Travel Agent">
    <global-element type="org.mule.tooling.ui.modules.core.global.ajaxConnector" name="ajaxServer" entity-id="c5dadc11-5680-4c87-af3e-2686e0a0588f">
        <properties>
            <property value="ajaxServer" name="name"/>
            <property value="http://0.0.0.0:8090/travelAgent" name="serverUrl"/>
            <property value="${app.home}/docroot" name="resourceBase"/>
            <property name="disableReplyTo"/>
            <property name="logLevel"/>
            <property name="refsThreshold"/>
            <property value="true" name="jsonCommented"/>
            <property name="timeout"/>
            <property name="interval"/>
            <property name="maxInterval"/>
            <property name="multiFrameInterval"/>
        </properties>
    </global-element>
    <global-element type="http://www.mulesoft.org/schema/mule/core/expression-filter" name="Expression" entity-id="bc588673-4eda-4ce3-bf93-59ec5c0ebd04">
        <properties>
            <property value="#[payload.price &lt; flowVars['minPrice']]" name="expression"/>
            <property name="nullReturnsTrue"/>
            <property value="LowerPriceFilter" name="name"/>
        </properties>
    </global-element>
    <global-element type="http://www.mulesoft.org/schema/mule/core/configuration" name="Configuration" entity-id="3f4175e1-836e-4303-8c21-80aae1422485">
        <properties>
            <property name="defaultExceptionStrategy-ref"/>
        </properties>
    </global-element>
    <global-element type="http://www.springframework.org/schema/beans/bean" name="Bean" entity-id="f5436c59-5b8d-4893-8e47-69a8b7328abd">
        <properties>
            <property value="Derby_Data_Source" name="id"/>
            <property name="name"/>
            <property value="org.enhydra.jdbc.standard.StandardXADataSource" name="class"/>
            <property name="parent"/>
            <property name="scope"/>
            <property name="children"/>
            <property name="abstract"/>
            <property name="lazy-init"/>
            <property name="autowire"/>
            <property name="depends-on"/>
            <property name="autowire-candidate"/>
            <property name="primary"/>
            <property name="init-method"/>
            <property value="shutdown" name="destroy-method"/>
            <property name="factory-method"/>
            <property name="factory-bean"/>
            <property-collection name="@http://www.springframework.org/schema/beans/property;0">
                <property value="driverName" name="name"/>
                <property value="org.apache.derby.jdbc.EmbeddedDriver" name="value"/>
            </property-collection>
            <property-collection name="@http://www.springframework.org/schema/beans/property;1">
                <property value="url" name="name"/>
                <property value="jdbc:derby:muleEmbeddedDB;create=true" name="value"/>
            </property-collection>
        </properties>
    </global-element>
    <global-element type="http://www.mulesoft.org/schema/mule/ee/jdbc/connector" name="JDBCConnector" entity-id="37f4d692-a2eb-44d3-8007-dba4ea91c86b">
        <properties>
            <property value="JDBCConnector" name="name"/>
            <property value="Derby_Data_Source" name="dataSource-ref to JDBC DataSource"/>
            <property value="Derby_Data_Source" name="dataSource-ref to Bean"/>
            <property name="dispatcherPoolFactory-ref"/>
            <property name="queryRunner-ref"/>
            <property name="resultSetHandler-ref"/>
            <property name="dynamicNotification"/>
            <property value="true" name="validateConnections"/>
            <property name="transactionPerMessage"/>
            <property value="-1" name="queryTimeout"/>
            <property value="0" name="pollingFrequency"/>
        </properties>
    </global-element>
    <global-unknown entity-id="cf4390de-67c9-46c8-9876-8be2162f1b8b">
        <content>&lt;jbossts:transaction-manager xmlns:jbossts=&quot;http://www.mulesoft.org/schema/mule/jbossts&quot;&gt;  
        &lt;property xmlns=&quot;http://www.mulesoft.org/schema/mule/core&quot; key=&quot;com.arjuna.ats.arjuna.coordinator.defaultTimeout&quot; value=&quot;600&quot;/&gt;  
        &lt;property xmlns=&quot;http://www.mulesoft.org/schema/mule/core&quot; key=&quot;com.arjuna.ats.arjuna.coordinator.txReaperTimeout&quot; value=&quot;1000000&quot;/&gt; 
    &lt;/jbossts:transaction-manager&gt;</content>
    </global-unknown>
    <global-element type="http://www.mulesoft.org/schema/mule/ee/data-mapper/config" name="TravelRequest to FlightReservationRequest" entity-id="18e1d6c3-0b2e-49be-8cfa-edada3fdbbd4">
        <properties>
            <property value="TravelRequest to FlightReservationRequest" name="name"/>
            <property value="travelrequest_to_flightreservationrequest.grf" name="transformationGraphPath"/>
        </properties>
    </global-element>
    <global-element type="http://www.mulesoft.org/schema/mule/ee/core/object-store-caching-strategy" name="Caching Strategy" entity-id="2ffdcdb5-3b1f-45ac-934c-b91df6aa7ea4">
        <properties>
            <property value="Caching_Strategy" name="name"/>
            <property name="eventKeyLabel"/>
            <property name="dont_use"/>
            <property name="key_expression"/>
            <property value="#[diffDays(payload.beginDate) &lt; 30]" name="keyGenerationExpression"/>
            <property name="key_generator"/>
            <property name="keyGenerator-ref"/>
            <property name="responseGenerator-ref"/>
            <property name="consumableFilter-ref"/>
            <property name="radioGroupLabel"/>
            <property name="EVENT_STRATEGY_TYPE"/>
            <property-collection name="@http://www.mulesoft.org/schema/mule/core/in-memory-store;0"/>
        </properties>
    </global-element>
    <global-element type="http://www.mulesoft.org/schema/mule/ee/data-mapper/config" name="TravelRequest to AvailabilityRequest" entity-id="65dc7f05-31f0-4bfe-9732-4942502aea88">
        <properties>
            <property value="TravelRequest to AvailabilityRequest" name="name"/>
            <property value="travelrequest_to_availabilityrequest.grf" name="transformationGraphPath"/>
        </properties>
    </global-element>
    <global-element type="http://www.mulesoft.org/schema/mule/ee/data-mapper/config" name="TravelRequest to AvailabilityRequest" entity-id="3e4a869f-5c5c-4f10-92c3-52e04410b702">
        <properties>
            <property value="TravelRequest to AvailabilityRequest" name="name"/>
            <property value="travelrequest_to_availabilityrequest_1.grf" name="transformationGraphPath"/>
        </properties>
    </global-element>
    <global-element type="http://www.mulesoft.org/schema/mule/ee/data-mapper/config" name="TravelRequest to PaymentRequest" entity-id="4a8ffef2-8c23-425b-8826-4301a6df2cb7">
        <properties>
            <property value="TravelRequest to PaymentRequest" name="name"/>
            <property value="travelrequest_to_paymentrequest.grf" name="transformationGraphPath"/>
        </properties>
    </global-element>
    <global-element type="http://www.mulesoft.org/schema/mule/ee/data-mapper/config" name="TravelRequest to ConfirmationRequest" entity-id="9bb21eb7-85f2-44ab-950f-7240a75eed33">
        <properties>
            <property value="TravelRequest to ConfirmationRequest" name="name"/>
            <property value="travelrequest_to_confirmationrequest.grf" name="transformationGraphPath"/>
        </properties>
    </global-element>
    <global-element type="org.mule.tooling.ui.modules.core.global.ScriptXform" name="Groovy" entity-id="ce7bb1c1-b533-408a-8772-dd630abfd343">
        <properties>
            <property name="returnClass"/>
            <property name="ignoreBadInput"/>
            <property name="encoding"/>
            <property name="mimeType"/>
            <property value="exceptionThrower" name="name"/>
            <property-collection name="@http://www.mulesoft.org/schema/mule/scripting/script;0">
                <property value="throw new Exception(&quot;Sorry, we could not process your request&quot;);" name="text"/>
                <property value="Groovy" name="engine"/>
            </property-collection>
        </properties>
    </global-element>
    <flow SubFlow="false" name="cities">
        <properties>
            <property name="processingStrategy2"/>
            <property name="processingStrategy"/>
            <property name="bussinessEventsLabel"/>
            <property name="tracking:enable-default-events"/>
            <property name="USE_TRANSACTION_ID"/>
            <property name="tracking:transaction-id"/>
        </properties>
        <lane hadOnlyOneElement="false" entity-id="e43c670c-c826-4e2f-8ce0-4715662b0ef7">
            <endpoint message-exchange-pattern="OneWay" direction="Inbound" type="org.mule.tooling.ui.modules.core.ajax.AJAX" name="/travelAgent/cities" entity-id="1d2d7e5f-81a1-41e9-9a35-8918dd1579c3">
                <properties>
                    <property value="one-way" name="exchange-pattern"/>
                    <property value="/travelAgent/cities" name="channel"/>
                    <property name="businessEventsLabel"/>
                    <property name="tracking:enable-default-events"/>
                    <property value="10000" name="responseTimeout"/>
                    <property name="encoding"/>
                    <property name="disableTransportTransformer"/>
                    <property name="mimeType"/>
                    <property name="address"/>
                    <property name="cacheMessages"/>
                    <property name="messageCacheSize"/>
                    <property value="ajaxServer" name="connector-ref"/>
                    <property name="ref"/>
                    <property name="transformer-refs"/>
                </properties>
            </endpoint>
            <pattern type="http://www.mulesoft.org/schema/mule/core/expression-transformer" name="Create Cities" entity-id="22228d7e-8223-4e2c-ad51-5461d03b18ee">
                <properties>
                    <property name="returnClass"/>
                    <property name="ignoreBadInput"/>
                    <property name="encoding"/>
                    <property name="mimeType"/>
                    <property value="#['[&quot;Dublin&quot;,&quot;Rome&quot;,&quot;Buenos Aires&quot;]']" name="expression"/>
                    <property name="returnSourceIfNull"/>
                </properties>
            </pattern>
        </lane>
    </flow>
    <flow SubFlow="false" name="orderRequest">
        <properties>
            <property name="processingStrategy2"/>
            <property name="processingStrategy"/>
            <property name="bussinessEventsLabel"/>
            <property name="tracking:enable-default-events"/>
            <property name="USE_TRANSACTION_ID"/>
            <property name="tracking:transaction-id"/>
        </properties>
        <lane hadOnlyOneElement="false" entity-id="08708386-e97f-4ac1-a69f-3e2fefbdecf2">
            <endpoint message-exchange-pattern="OneWay" direction="Inbound" type="org.mule.tooling.ui.modules.core.ajax.AJAX" name="/travelAgent/request" entity-id="e7d79216-eadb-47b5-b185-a9e383ca0ed7">
                <properties>
                    <property value="one-way" name="exchange-pattern"/>
                    <property value="/travelAgent/request" name="channel"/>
                    <property name="businessEventsLabel"/>
                    <property name="tracking:enable-default-events"/>
                    <property value="10000" name="responseTimeout"/>
                    <property name="encoding"/>
                    <property name="disableTransportTransformer"/>
                    <property name="mimeType"/>
                    <property name="address"/>
                    <property name="cacheMessages"/>
                    <property name="messageCacheSize"/>
                    <property value="ajaxServer" name="connector-ref"/>
                    <property name="ref"/>
                    <property name="transformer-refs"/>
                </properties>
            </endpoint>
            <pattern type="http://www.mulesoft.org/schema/mule/json/json-to-object-transformer" name="JSON TravelRequest to Java TravelRequest" entity-id="bd63a240-7f3e-4eb9-a67d-973f777f0db0">
                <properties>
                    <property name="returnClass"/>
                    <property name="ignoreBadInput"/>
                    <property name="encoding"/>
                    <property name="mimeType"/>
                    <property name="mapper-ref"/>
                </properties>
            </pattern>
            <pattern type="http://www.mulesoft.org/schema/mule/cxf/soapComponent" name="TravelAgentService Client" entity-id="8d5a7316-8f0d-4bc6-94c7-ace4642fd2de">
                <properties>
                    <property name="configuration-ref"/>
                    <property value="http://www.mulesoft.org/schema/mule/cxf/jaxws-client" name="org.mule.tooling.ui.modules.core.widgets.meta.ModeAttribute"/>
                    <property value="bookTrip" name="operation"/>
                    <property name="serviceClass"/>
                    <property name="decoupledEndpoint"/>
                    <property value="com.mule_travel.travelagent.TravelAgentService_Service" name="clientClass"/>
                    <property value="TravelAgentSOAP" name="port"/>
                    <property name="mtomEnabled"/>
                    <property name="wsdlLocation"/>
                    <property value="true" name="enableMuleSoapHeaders"/>
                </properties>
            </pattern>
            <endpoint message-exchange-pattern="OneWay" direction="Outbound" type="http://www.mulesoft.org/schema/mule/http/endpoint" name="/reservations" entity-id="4aa33976-7e9c-401b-ba29-59f17f5aa57f">
                <properties>
                    <property value="one-way" name="exchange-pattern"/>
                    <property value="request-response" name="exchange-pattern"/>
                    <property value="http://www.mulesoft.org/schema/mule/http/endpoint" name="org.mule.tooling.ui.modules.core.widgets.meta.ModeAttribute"/>
                    <property name="httpLabel"/>
                    <property value="localhost" name="host"/>
                    <property value="8081" name="port"/>
                    <property value="reservations" name="path"/>
                    <property name="method"/>
                    <property name="businessEventsLabel"/>
                    <property name="tracking:enable-default-events"/>
                    <property name="address"/>
                    <property name="encoding"/>
                    <property name="disableTransportTransformer"/>
                    <property name="mimeType"/>
                    <property name="responseTimeout"/>
                    <property name="followRedirects"/>
                    <property name="connector-ref"/>
                    <property name="ref"/>
                    <property name="transformer-refs"/>
                    <property name="responseTransformer-refs"/>
                    <property name="user"/>
                    <property name="password"/>
                    <property name="contentType"/>
                    <property name="keep-alive"/>
                </properties>
            </endpoint>
        </lane>
    </flow>
    <flow SubFlow="false" name="reservations">
        <properties>
            <property name="processingStrategy2"/>
            <property name="processingStrategy"/>
            <property name="bussinessEventsLabel"/>
            <property name="tracking:enable-default-events"/>
            <property name="USE_TRANSACTION_ID"/>
            <property name="tracking:transaction-id"/>
        </properties>
        <lane hadOnlyOneElement="false" entity-id="f47dc37e-d9b9-41fb-ad8b-d099353e8a5f">
            <endpoint message-exchange-pattern="OneWay" direction="Inbound" type="http://www.mulesoft.org/schema/mule/http/endpoint" name="/reservations" entity-id="32b68cee-dcca-4878-8fcb-03a2985c6ef3">
                <properties>
                    <property value="one-way" name="exchange-pattern"/>
                    <property value="request-response" name="exchange-pattern"/>
                    <property value="http://www.mulesoft.org/schema/mule/http/endpoint" name="org.mule.tooling.ui.modules.core.widgets.meta.ModeAttribute"/>
                    <property name="httpLabel"/>
                    <property value="localhost" name="host"/>
                    <property value="8081" name="port"/>
                    <property value="reservations" name="path"/>
                    <property name="method"/>
                    <property name="businessEventsLabel"/>
                    <property name="tracking:enable-default-events"/>
                    <property name="address"/>
                    <property name="encoding"/>
                    <property name="disableTransportTransformer"/>
                    <property name="mimeType"/>
                    <property name="responseTimeout"/>
                    <property name="followRedirects"/>
                    <property name="connector-ref"/>
                    <property name="ref"/>
                    <property name="transformer-refs"/>
                    <property name="responseTransformer-refs"/>
                    <property name="user"/>
                    <property name="password"/>
                    <property name="contentType"/>
                    <property name="keep-alive"/>
                </properties>
            </endpoint>
            <pattern type="http://www.mulesoft.org/schema/mule/cxf/soapComponent" name="TravelAgentService" entity-id="3b2386bf-e453-473c-974e-c57d51384d56">
                <properties>
                    <property name="configuration-ref"/>
                    <property value="http://www.mulesoft.org/schema/mule/cxf/jaxws-service" name="org.mule.tooling.ui.modules.core.widgets.meta.ModeAttribute"/>
                    <property name="configuration-ref"/>
                    <property name="bindingId"/>
                    <property value="80" name="port"/>
                    <property name="namespace"/>
                    <property name="service"/>
                    <property value="com.mule_travel.travelagent.TravelAgentService" name="serviceClass"/>
                    <property name="validationEnabled"/>
                    <property name="mtomEnabled"/>
                    <property name="wsdlLocation"/>
                    <property name="enableMuleSoapHeaders"/>
                </properties>
            </pattern>
            <scope type="org.mule.tooling.ui.modules.core.scope.enricher" name="Enrich with flightReservationResponse" entity-id="c43682fd-ca27-4fdf-8c52-c6a2f54a4817">
                <properties>
                    <property name="source"/>
                    <property value="#[header:session:flightReservationResponse]" name="target"/>
                </properties>
                <compartment entity-id="61e21dea-bf6c-4ce2-80e0-33783f8e107c">
                    <lane hadOnlyOneElement="false" entity-id="5b4e91a8-ddbc-4b80-b264-031605c90d2e">
                        <pattern type="http://www.mulesoft.org/schema/mule/core/flow-ref" name="Reserve flight" entity-id="c300e567-395a-47a5-953f-0602f132c704">
                            <properties>
<property value="reserveFlight" name="name"/>
                            </properties>
                        </pattern>
                    </lane>
                </compartment>
            </scope>
            <scope type="org.mule.tooling.ui.modules.core.scope.enricher" name="Enrich with suitableRoom" entity-id="149c37a8-31cc-4e99-b394-2e45cbf6f91b">
                <properties>
                    <property name="source"/>
                    <property value="#[variable:suitableRoom]" name="target"/>
                </properties>
                <compartment entity-id="c0382eff-3e89-4abf-98b9-8ab0a5450648">
                    <lane hadOnlyOneElement="false" entity-id="63b7389b-ff54-48e4-a858-cdfcf3dbede7">
                        <pattern type="http://www.mulesoft.org/schema/mule/core/flow-ref" name="Get best hotel room" entity-id="caeaa90f-329d-45ce-ad73-d6723d5ba52d">
                            <properties>
<property value="getBestHotelRoom" name="name"/>
                            </properties>
                        </pattern>
                    </lane>
                </compartment>
            </scope>
            <pattern type="http://www.mulesoft.org/schema/mule/core/message-filter" name="Filter on suitable room found" entity-id="751a64a0-3745-4b55-aa8e-a3e3cbdb4d1e">
                <properties>
                    <property value="exceptionThrower" name="onUnaccepted"/>
                    <property name="throwOnUnaccepted"/>
                    <property-collection name="@http://www.mulesoft.org/schema/mule/core/expression-filter;0">
                        <property value="'com.mule_hotel.hotelservice.AvailabilityResponse$Room' == suitableRoom.class.name)" name="expression"/>
                    </property-collection>
                </properties>
            </pattern>
            <scope type="org.mule.tooling.ui.modules.core.scope.enricher" name="Enrich with commission" entity-id="d2608b38-e229-4878-ae82-57b5676246b2">
                <properties>
                    <property name="source"/>
                    <property value="#[variable:commissionRate]" name="target"/>
                </properties>
                <compartment entity-id="127b9de2-cd97-4bef-93e8-f74c7d22542c">
                    <lane hadOnlyOneElement="false" entity-id="16011eed-21f0-404b-bba3-42fda12861c2">
                        <pattern type="http://www.mulesoft.org/schema/mule/core/flow-ref" name="Get commission rate" entity-id="e78391db-6b19-4189-abde-963ab72e1d11">
                            <properties>
<property value="getCommissionRate" name="name"/>
                            </properties>
                        </pattern>
                    </lane>
                </compartment>
            </scope>
            <endpoint message-exchange-pattern="OneWay" direction="Outbound" type="http://www.mulesoft.org/schema/mule/vm/endpoint" name="Confirm" entity-id="38da21b6-7678-4f9d-ab15-c7f62dbe650d">
                <properties>
                    <property value="one-way" name="exchange-pattern"/>
                    <property value="request-response" name="exchange-pattern"/>
                    <property value="confirm" name="path"/>
                    <property name="businessEventsLabel"/>
                    <property name="tracking:enable-default-events"/>
                    <property name="address"/>
                    <property name="responseTimeout"/>
                    <property name="encoding"/>
                    <property name="disableTransportTransformer"/>
                    <property name="mimeType"/>
                    <property name="connector-ref"/>
                    <property name="ref"/>
                    <property name="transformer-refs"/>
                    <property name="responseTransformer-refs"/>
                </properties>
            </endpoint>
            <pattern type="http://www.mulesoft.org/schema/mule/core/expression-transformer" name="Expression" entity-id="8003c1c1-631b-4900-a295-53799f73f9e1">
                <properties>
                    <property name="returnClass"/>
                    <property name="ignoreBadInput"/>
                    <property name="encoding"/>
                    <property name="mimeType"/>
                    <property value="#[response = new com.mule_travel.travelagent.TravelResponse(); response.setConfirmationNumber(&quot;1234&quot;); response.setTotalPrice(price.floatValue()); response]" name="expression"/>
                    <property name="returnSourceIfNull"/>
                </properties>
            </pattern>
            <pattern type="http://www.mulesoft.org/schema/mule/core/logger" name="Logger" entity-id="fa044e54-8536-4eda-bdc2-5f6a801faf2c">
                <properties>
                    <property value="Successfully confirmed reservations" name="message"/>
                    <property value="INFO" name="level"/>
                    <property name="category"/>
                </properties>
            </pattern>
        </lane>
    </flow>
    <flow SubFlow="true" name="reserveFlight">
        <properties>
            <property name="processingStrategy2"/>
            <property name="processingStrategy"/>
            <property name="bussinessEventsLabel"/>
            <property name="tracking:enable-default-events"/>
            <property name="USE_TRANSACTION_ID"/>
            <property name="tracking:transaction-id"/>
        </properties>
        <lane hadOnlyOneElement="false" entity-id="cb1a6322-9269-462e-b241-430f227b493d">
            <pattern type="http://www.mulesoft.org/schema/mule/core/expression-transformer" name="TravelRequest to FlightReservationRequest" entity-id="180f440b-b0f5-4a5e-b522-af4e8b15222b">
                <properties>
                    <property name="returnClass"/>
                    <property name="ignoreBadInput"/>
                    <property name="encoding"/>
                    <property name="mimeType"/>
                    <property value="#[reservationRequest = new com.mule_air.airline.FlightReservationRequest(); startDate = payload.beginDate; endDate = Calendar.getInstance(); endDate.setTime(startDate); endDate.add(Calendar.DATE, payload.nights); reservationRequest.setDeparting(startDate); reservationRequest.setReturning(endDate.time); reservationRequest.setFrom(payload.fromCity); reservationRequest.setTo(payload.toCity); reservationRequest.setTravelAgentId(&quot;Mule_Travel&quot;); reservationRequest]" name="expression"/>
                    <property name="returnSourceIfNull"/>
                </properties>
            </pattern>
            <pattern type="http://www.mulesoft.org/schema/mule/cxf/soapComponent" name="AirlineService" entity-id="d4a5f9f0-5f51-4f46-8c06-7c8876ead3e7">
                <properties>
                    <property name="configuration-ref"/>
                    <property value="http://www.mulesoft.org/schema/mule/cxf/jaxws-client" name="org.mule.tooling.ui.modules.core.widgets.meta.ModeAttribute"/>
                    <property value="reserveFlight" name="operation"/>
                    <property name="serviceClass"/>
                    <property name="decoupledEndpoint"/>
                    <property value="com.mule_air.airline.AirlineService_Service" name="clientClass"/>
                    <property value="AirlineSOAP" name="port"/>
                    <property name="mtomEnabled"/>
                    <property name="wsdlLocation"/>
                    <property value="true" name="enableMuleSoapHeaders"/>
                </properties>
            </pattern>
            <endpoint message-exchange-pattern="OneWay" direction="Outbound" type="http://www.mulesoft.org/schema/mule/http/endpoint" name="/airline/reserveFlight" entity-id="951b14f4-46fc-42f3-a834-0775558b4176">
                <properties>
                    <property value="one-way" name="exchange-pattern"/>
                    <property value="request-response" name="exchange-pattern"/>
                    <property value="http://www.mulesoft.org/schema/mule/http/endpoint" name="org.mule.tooling.ui.modules.core.widgets.meta.ModeAttribute"/>
                    <property name="httpLabel"/>
                    <property value="localhost" name="host"/>
                    <property value="9090" name="port"/>
                    <property value="reservations" name="path"/>
                    <property name="method"/>
                    <property name="businessEventsLabel"/>
                    <property name="tracking:enable-default-events"/>
                    <property name="address"/>
                    <property name="encoding"/>
                    <property name="disableTransportTransformer"/>
                    <property name="mimeType"/>
                    <property name="responseTimeout"/>
                    <property name="followRedirects"/>
                    <property name="connector-ref"/>
                    <property name="ref"/>
                    <property name="transformer-refs"/>
                    <property name="responseTransformer-refs"/>
                    <property name="user"/>
                    <property name="password"/>
                    <property name="contentType"/>
                    <property name="keep-alive"/>
                </properties>
            </endpoint>
        </lane>
    </flow>
    <flow SubFlow="true" name="getAvailableRooms">
        <properties>
            <property name="processingStrategy2"/>
            <property name="processingStrategy"/>
            <property name="bussinessEventsLabel"/>
            <property name="tracking:enable-default-events"/>
            <property name="USE_TRANSACTION_ID"/>
            <property name="tracking:transaction-id"/>
        </properties>
        <lane hadOnlyOneElement="false" entity-id="94b78102-3790-4e6b-a668-44f74058d7df">
            <pattern type="http://www.mulesoft.org/schema/mule/core/expression-transformer" name="Expression" entity-id="ea04243c-b0ab-4cf7-aa0f-a01b55665d70">
                <properties>
                    <property name="returnClass"/>
                    <property name="ignoreBadInput"/>
                    <property name="encoding"/>
                    <property name="mimeType"/>
                    <property value="#[request = new com.mule_hotel.hotelservice.AvailabilityRequest(); request.setStartDate(payload.beginDate); request.setNumberOfNights(payload.nights); request.setTravelAgentId('mule-travel'); request.setCity(payload.toCity); request]" name="expression"/>
                    <property name="returnSourceIfNull"/>
                </properties>
            </pattern>
            <pattern type="http://www.mulesoft.org/schema/mule/cxf/soapComponent" name="HotelService" entity-id="484f63f2-3e02-4042-a5d4-47778c8e9d4c">
                <properties>
                    <property name="configuration-ref"/>
                    <property value="http://www.mulesoft.org/schema/mule/cxf/jaxws-client" name="org.mule.tooling.ui.modules.core.widgets.meta.ModeAttribute"/>
                    <property value="getAvailableRooms" name="operation"/>
                    <property name="serviceClass"/>
                    <property name="decoupledEndpoint"/>
                    <property value="com.mule_hotel.hotelservice.HotelService_Service" name="clientClass"/>
                    <property value="HotelServiceSOAP" name="port"/>
                    <property name="mtomEnabled"/>
                    <property name="wsdlLocation"/>
                    <property name="enableMuleSoapHeaders"/>
                </properties>
            </pattern>
            <endpoint message-exchange-pattern="OneWay" direction="Outbound" type="http://www.mulesoft.org/schema/mule/http/endpoint" name="/reservations" entity-id="fefb5b7d-a7ac-4ce0-acc9-6f6e09234634">
                <properties>
                    <property value="one-way" name="exchange-pattern"/>
                    <property value="request-response" name="exchange-pattern"/>
                    <property value="http://www.mulesoft.org/schema/mule/http/endpoint" name="org.mule.tooling.ui.modules.core.widgets.meta.ModeAttribute"/>
                    <property name="httpLabel"/>
                    <property value="localhost" name="host"/>
                    <property value="9595" name="port"/>
                    <property value="reservations" name="path"/>
                    <property name="method"/>
                    <property name="businessEventsLabel"/>
                    <property name="tracking:enable-default-events"/>
                    <property name="address"/>
                    <property name="encoding"/>
                    <property name="disableTransportTransformer"/>
                    <property name="mimeType"/>
                    <property name="responseTimeout"/>
                    <property name="followRedirects"/>
                    <property name="connector-ref"/>
                    <property name="ref"/>
                    <property name="transformer-refs"/>
                    <property name="responseTransformer-refs"/>
                    <property name="user"/>
                    <property name="password"/>
                    <property name="contentType"/>
                    <property name="keep-alive"/>
                </properties>
            </endpoint>
        </lane>
    </flow>
    <flow SubFlow="true" name="getBestHotelRoom">
        <properties>
            <property name="processingStrategy2"/>
            <property name="processingStrategy"/>
            <property name="bussinessEventsLabel"/>
            <property name="tracking:enable-default-events"/>
            <property name="USE_TRANSACTION_ID"/>
            <property name="tracking:transaction-id"/>
        </properties>
        <lane hadOnlyOneElement="false" entity-id="eed5e65a-8de3-4b9e-b940-7093702260ff">
            <scope type="org.mule.tooling.ui.modules.core.scope.enricher" name="Enrich with availabilityResponse" entity-id="0a232e65-c67f-403e-809e-2f90e13f0b4f">
                <properties>
                    <property name="source"/>
                    <property value="#[variable:availabilityResponse]" name="target"/>
                </properties>
                <compartment entity-id="b0c92a2e-626b-4d0b-afdd-6cc973b1eb5b">
                    <lane hadOnlyOneElement="false" entity-id="e1fc4cf7-9163-43e2-9675-c55911a38032">
                        <pattern type="http://www.mulesoft.org/schema/mule/core/flow-ref" name="Get available Rooms" entity-id="c2e1e669-cbc5-4895-b622-080447def5a6">
                            <properties>
<property value="getAvailableRooms" name="name"/>
                            </properties>
                        </pattern>
                    </lane>
                </compartment>
            </scope>
            <pattern type="http://www.mulesoft.org/schema/mule/core/logger" name="Logger" entity-id="1445c6ee-0104-4f43-988b-aacf0dcfb6dc">
                <properties>
                    <property name="message"/>
                    <property value="INFO" name="level"/>
                    <property name="category"/>
                </properties>
            </pattern>
            <pattern type="http://www.mulesoft.org/schema/mule/core/variable-transformer" name="Initialize minPrice" entity-id="7bb0c86e-cc50-4ec5-bd77-f866e7870592">
                <properties>
                    <property value="http://www.mulesoft.org/schema/mule/core/set-variable" name="org.mule.tooling.ui.modules.core.widgets.meta.ModeAttribute"/>
                    <property value="minPrice" name="variableName"/>
                    <property value="#[Double.MAX_VALUE]" name="value"/>
                </properties>
            </pattern>
            <pattern type="http://www.mulesoft.org/schema/mule/core/logger" name="Logger" entity-id="f8064fc1-c894-4dea-9091-681c2a28bc97">
                <properties>
                    <property value="#[variable:availabilityResponse]" name="message"/>
                    <property value="INFO" name="level"/>
                    <property name="category"/>
                </properties>
            </pattern>
            <scope type="http://www.mulesoft.org/schema/mule/core/foreach" name="For each room offered" entity-id="53a5722c-bda4-4e7a-a6b1-9e69e95d0dac">
                <properties>
                    <property value="#[flowVars['availabilityResponse'].rooms]" name="collection"/>
                    <property name="counterVariableName"/>
                    <property name="batchSize"/>
                    <property name="rootMessageVariableName"/>
                </properties>
                <compartment entity-id="e49f884f-d25e-4850-bcc6-ae8763232f53">
                    <lane hadOnlyOneElement="false" entity-id="6de53f83-d5c9-4fc8-85d1-2bebf20e3b39">
                        <pattern type="org.mule.tooling.ui.modules.core.filter.Expression" name="Filter on RoomType = Preference" entity-id="b729aeeb-88ac-485c-9357-5eadc22c23a2">
                            <properties>
<property value="#[flowVars['rootMessage'].payload.roomPreference == payload.roomType]" name="expression"/>
<property name="nullReturnsTrue"/>
                            </properties>
                        </pattern>
                        <pattern type="org.mule.tooling.ui.modules.core.filter.GlobalFilterRef" name="Filter on lower price" entity-id="966a3640-d546-416a-9ebb-5a4d7ccf0bbd">
                            <properties>
<property value="LowerPriceFilter" name="ref"/>
                            </properties>
                        </pattern>
                        <pattern type="http://www.mulesoft.org/schema/mule/core/variable-transformer" name="Update minPrice" entity-id="3bdc22cf-94f0-436a-a219-0ab0f0ab70a6">
                            <properties>
<property value="http://www.mulesoft.org/schema/mule/core/set-variable" name="org.mule.tooling.ui.modules.core.widgets.meta.ModeAttribute"/>
<property value="minPrice" name="variableName"/>
<property value="#[payload.price]" name="value"/>
                            </properties>
                        </pattern>
                        <pattern type="http://www.mulesoft.org/schema/mule/core/variable-transformer" name="Update lowestPriceRoom" entity-id="f970c5df-4d13-4e3c-b2ad-66876bfcc8b0">
                            <properties>
<property value="http://www.mulesoft.org/schema/mule/core/set-variable" name="org.mule.tooling.ui.modules.core.widgets.meta.ModeAttribute"/>
<property value="lowestPriceRoom" name="variableName"/>
<property value="#[payload]" name="value"/>
                            </properties>
                        </pattern>
                    </lane>
                </compartment>
            </scope>
            <pattern type="http://www.mulesoft.org/schema/mule/core/expression-transformer" name="Expression" entity-id="84c708a2-3e26-4b82-978f-356acc211132">
                <properties>
                    <property name="returnClass"/>
                    <property name="ignoreBadInput"/>
                    <property name="encoding"/>
                    <property name="mimeType"/>
                    <property value="#[if (flowVars['lowestPriceRoom'] != null) { flowVars['lowestPriceRoom'] } else { 'NOT FOUND' }]" name="expression"/>
                    <property name="returnSourceIfNull"/>
                </properties>
            </pattern>
        </lane>
    </flow>
    <flow SubFlow="true" name="getCommissionRate">
        <properties>
            <property name="processingStrategy2"/>
            <property name="processingStrategy"/>
            <property name="bussinessEventsLabel"/>
            <property name="tracking:enable-default-events"/>
            <property name="USE_TRANSACTION_ID"/>
            <property name="tracking:transaction-id"/>
        </properties>
        <lane hadOnlyOneElement="false" entity-id="d85fe5fa-3ed6-4d7c-9a70-0d2c8b6d6ee4">
            <scope type="http://www.mulesoft.org/schema/mule/ee/core/cache" name="Cache Commission Rate" entity-id="5437b4b9-2652-4e53-8dd3-b7654d412d9b">
                <properties>
                    <property value="Caching_Strategy" name="cachingStrategy-ref"/>
                    <property name="filterLabel"/>
                    <property name="dont_use"/>
                    <property name="use_an_expression"/>
                    <property value="#[diffDays(payload.beginDate) &lt; 30]" name="filterExpression"/>
                    <property name="use_a_filter"/>
                    <property name="filter-ref"/>
                </properties>
                <compartment entity-id="b463e6ba-d568-424d-9967-14cf3a849309">
                    <lane hadOnlyOneElement="false" entity-id="d0288a9e-93bd-4142-84e4-12bf4a5102f1">
                        <endpoint message-exchange-pattern="OneWay" direction="Outbound" type="http://www.mulesoft.org/schema/mule/http/endpoint" name="Invoke Commission Service" entity-id="915da6a9-6b55-46ef-869b-39a72e1776b6">
                            <properties>
<property value="one-way" name="exchange-pattern"/>
<property value="request-response" name="exchange-pattern"/>
<property value="http://www.mulesoft.org/schema/mule/http/endpoint" name="org.mule.tooling.ui.modules.core.widgets.meta.ModeAttribute"/>
<property name="httpLabel"/>
<property value="localhost" name="host"/>
<property value="9999" name="port"/>
<property value="commissions?date=#[payload.beginDate]" name="path"/>
<property value="GET" name="method"/>
<property name="businessEventsLabel"/>
<property name="tracking:enable-default-events"/>
<property name="address"/>
<property name="encoding"/>
<property value="true" name="disableTransportTransformer"/>
<property name="mimeType"/>
<property name="responseTimeout"/>
<property name="followRedirects"/>
<property name="connector-ref"/>
<property name="ref"/>
<property name="transformer-refs"/>
<property name="responseTransformer-refs"/>
<property name="user"/>
<property name="password"/>
<property name="contentType"/>
<property name="keep-alive"/>
                            </properties>
                        </endpoint>
                    </lane>
                </compartment>
            </scope>
            <pattern type="http://www.mulesoft.org/schema/mule/core/object-to-string-transformer" name="Object to String" entity-id="3ab7a9c2-93d0-4437-a346-a57858eb9801">
                <properties>
                    <property name="returnClass"/>
                    <property name="ignoreBadInput"/>
                    <property name="encoding"/>
                    <property name="mimeType"/>
                </properties>
            </pattern>
        </lane>
    </flow>
    <flow SubFlow="false" name="confirmReservations">
        <properties>
            <property name="processingStrategy2"/>
            <property name="processingStrategy"/>
            <property name="bussinessEventsLabel"/>
            <property name="tracking:enable-default-events"/>
            <property name="USE_TRANSACTION_ID"/>
            <property name="tracking:transaction-id"/>
        </properties>
        <lane hadOnlyOneElement="false" entity-id="e69bc1af-d190-42d3-af3c-30ef105320a3">
            <endpoint message-exchange-pattern="OneWay" direction="Inbound" type="http://www.mulesoft.org/schema/mule/vm/endpoint" name="confirm" entity-id="312771d8-5138-451c-a9f2-4a81746c696d">
                <properties>
                    <property value="one-way" name="exchange-pattern"/>
                    <property value="request-response" name="exchange-pattern"/>
                    <property value="confirm" name="path"/>
                    <property name="businessEventsLabel"/>
                    <property name="tracking:enable-default-events"/>
                    <property name="address"/>
                    <property name="responseTimeout"/>
                    <property name="encoding"/>
                    <property name="disableTransportTransformer"/>
                    <property name="mimeType"/>
                    <property name="connector-ref"/>
                    <property name="ref"/>
                    <property name="transformer-refs"/>
                    <property name="responseTransformer-refs"/>
                </properties>
            </endpoint>
            <scope type="org.mule.tooling.ui.modules.core.scope.enricher" name="Enrich with paymentResponse" entity-id="f0c2ce4c-dfa0-43b5-93db-996d0ca39097">
                <properties>
                    <property name="source"/>
                    <property value="#[variable:paymentResponse]" name="target"/>
                </properties>
                <compartment entity-id="da4210e3-4d09-420b-9aa8-84134bd1c734">
                    <lane hadOnlyOneElement="false" entity-id="960e8a6b-fe3b-434e-b594-0a886374230d">
                        <pattern type="http://www.mulesoft.org/schema/mule/core/flow-ref" name="Authorise Payment" entity-id="e87112b1-bcf0-4015-82a9-653e14362e35">
                            <properties>
<property value="authorisePayment" name="name"/>
                            </properties>
                        </pattern>
                    </lane>
                </compartment>
            </scope>
            <pattern type="http://www.mulesoft.org/schema/mule/core/variable-transformer" name="Set Rollback = CREDIT_CARD" entity-id="47ea7146-a9b5-4938-8661-ced613a01342">
                <properties>
                    <property value="http://www.mulesoft.org/schema/mule/core/set-variable" name="org.mule.tooling.ui.modules.core.widgets.meta.ModeAttribute"/>
                    <property value="rollback" name="variableName"/>
                    <property value="&quot;CREDIT_CARD&quot;" name="value"/>
                </properties>
            </pattern>
            <scope type="org.mule.tooling.ui.modules.core.scope.enricher" name="Enrich with flightConfirmationResponse" entity-id="56be7c17-8aee-4048-b08c-c28fed97c20a">
                <properties>
                    <property name="source"/>
                    <property value="#[variable:flightConfirmationResponse]" name="target"/>
                </properties>
                <compartment entity-id="220c7c2f-31d0-46a0-8586-c8671d5a18c7">
                    <lane hadOnlyOneElement="false" entity-id="11580764-4ae3-4ddc-b67e-6615c38b5016">
                        <pattern type="http://www.mulesoft.org/schema/mule/core/flow-ref" name="Confirm Flight" entity-id="671f027a-26a0-46b7-b231-06c7a445b399">
                            <properties>
<property value="confirmFlight" name="name"/>
                            </properties>
                        </pattern>
                    </lane>
                </compartment>
            </scope>
            <pattern type="http://www.mulesoft.org/schema/mule/core/variable-transformer" name="Set Rollback = FLIGHT" entity-id="c246fa08-e379-4e05-ad47-c7481497d18c">
                <properties>
                    <property value="http://www.mulesoft.org/schema/mule/core/set-variable" name="org.mule.tooling.ui.modules.core.widgets.meta.ModeAttribute"/>
                    <property value="rollback" name="variableName"/>
                    <property value="&quot;FLIGHT&quot;" name="value"/>
                </properties>
            </pattern>
            <scope type="org.mule.tooling.ui.modules.core.scope.enricher" name="Enrich with hotelConfirmationResponse" entity-id="24d3cbcc-9de2-43c9-8e5a-f355241efb4a">
                <properties>
                    <property name="source"/>
                    <property value="#[variable:hotelConfirmationResponse]" name="target"/>
                </properties>
                <compartment entity-id="7c1b6ed5-dce0-40db-8867-36288ff58ecf">
                    <lane hadOnlyOneElement="false" entity-id="2ff597f3-961e-475d-8501-d88f7b8354b4">
                        <pattern type="http://www.mulesoft.org/schema/mule/core/flow-ref" name="Confirm Hotel Room" entity-id="14750be1-f3e7-4bc9-8c85-f1790a0598ad">
                            <properties>
<property value="confirmHotelRoom" name="name"/>
                            </properties>
                        </pattern>
                    </lane>
                </compartment>
            </scope>
            <scope type="http://www.mulesoft.org/schema/mule/core/choice-exception-strategy" name="Choice Exception Strategy" entity-id="74cbc350-7197-4183-b2dc-66775aa0e422">
                <compartment entity-id="8cf887e2-765b-433d-82c3-62cd5ecf568c">
                    <lane hadOnlyOneElement="false" entity-id="cea21b31-3a2b-407e-ae32-9f5f76d3289f">
                        <scope type="http://www.mulesoft.org/schema/mule/core/catch-exception-strategy" name="Catch Exception Strategy" entity-id="b5743564-269d-42b1-9e6b-26e1e306663f">
                            <properties>
<property name=""/>
<property value="#[rollback == &quot;CREDIT_CARD&quot;]" name="when"/>
<property name="enableNotifications"/>
                            </properties>
                            <compartment entity-id="93608075-0512-4122-af76-ae75dd760311">
<lane hadOnlyOneElement="false" entity-id="9e4afb4c-c664-434c-896b-5265e1317c38">
    <pattern type="http://www.mulesoft.org/schema/mule/core/flow-ref" name="Cancel Payment" entity-id="60f00b40-9f74-4537-9b20-3ecc8f2915a2">
        <properties>
            <property value="cancelPayment" name="name"/>
        </properties>
    </pattern>
    <pattern type="http://www.mulesoft.org/schema/mule/core/flow-ref" name="throw Exception" entity-id="1f3d27a6-bf50-4913-a25f-2624c9bfeefc">
        <properties>
            <property value="throwException" name="name"/>
        </properties>
    </pattern>
</lane>
                            </compartment>
                        </scope>
                        <scope type="http://www.mulesoft.org/schema/mule/core/catch-exception-strategy" name="Catch Exception Strategy" entity-id="9a228815-836a-482c-9bb8-f081386ef364">
                            <properties>
<property name=""/>
<property value="#[rollback == &quot;FLIGHT&quot;]" name="when"/>
<property name="enableNotifications"/>
                            </properties>
                            <compartment entity-id="bc91a64d-0d5b-4cd1-a386-831df44ecdc0">
<lane hadOnlyOneElement="false" entity-id="da18a670-1d00-488a-9f8a-22a77f2e2e6e">
    <pattern type="http://www.mulesoft.org/schema/mule/core/flow-ref" name="Cancel Flight" entity-id="b6aee494-ecca-4333-b0c4-b62ff056e6bb">
        <properties>
            <property value="cancelFlight" name="name"/>
        </properties>
    </pattern>
    <pattern type="http://www.mulesoft.org/schema/mule/core/flow-ref" name="Cancel Payment" entity-id="be31da07-256f-47bf-86cd-3483fdf121de">
        <properties>
            <property value="cancelPayment" name="name"/>
        </properties>
    </pattern>
    <pattern type="http://www.mulesoft.org/schema/mule/core/flow-ref" name="throwException" entity-id="608db6d4-5f1c-4cec-ab3c-7d1b0ad8613a">
        <properties>
            <property value="throwException" name="name"/>
        </properties>
    </pattern>
</lane>
                            </compartment>
                        </scope>
                    </lane>
                </compartment>
            </scope>
        </lane>
    </flow>
    <flow SubFlow="false" name="throwException">
        <properties>
            <property name="processingStrategy2"/>
            <property name="processingStrategy"/>
            <property name="bussinessEventsLabel"/>
            <property name="tracking:enable-default-events"/>
            <property name="USE_TRANSACTION_ID"/>
            <property name="tracking:transaction-id"/>
        </properties>
        <lane hadOnlyOneElement="false" entity-id="b02c44ae-b197-4fe8-8343-d24a9e1ec661">
            <pattern type="http://www.mulesoft.org/schema/mule/scripting/groovyComponent" name="Throw Exception" entity-id="31c5bc34-0e81-40b7-bb9b-b2667bf4dd60">
                <properties>
                    <property-collection name="@http://www.mulesoft.org/schema/mule/scripting/script;0">
                        <property value="throw new RuntimeException(&quot;Unable to confirm reservations&quot;);" name="text"/>
                        <property value="Groovy" name="engine"/>
                    </property-collection>
                </properties>
            </pattern>
        </lane>
    </flow>
    <flow SubFlow="false" name="commissionService">
        <properties>
            <property name="processingStrategy2"/>
            <property name="processingStrategy"/>
            <property name="bussinessEventsLabel"/>
            <property name="tracking:enable-default-events"/>
            <property name="USE_TRANSACTION_ID"/>
            <property name="tracking:transaction-id"/>
        </properties>
        <lane hadOnlyOneElement="false" entity-id="1116dfb0-1a0a-4f32-8c34-1494c9252b86">
            <endpoint message-exchange-pattern="OneWay" direction="Inbound" type="http://www.mulesoft.org/schema/mule/http/endpoint" name="/commission" entity-id="44ee0b34-dd92-4b36-bba7-6ea596bd9d78">
                <properties>
                    <property value="one-way" name="exchange-pattern"/>
                    <property value="request-response" name="exchange-pattern"/>
                    <property value="http://www.mulesoft.org/schema/mule/http/endpoint" name="org.mule.tooling.ui.modules.core.widgets.meta.ModeAttribute"/>
                    <property name="httpLabel"/>
                    <property value="localhost" name="host"/>
                    <property value="9999" name="port"/>
                    <property value="commission" name="path"/>
                    <property name="method"/>
                    <property name="businessEventsLabel"/>
                    <property name="tracking:enable-default-events"/>
                    <property name="address"/>
                    <property name="encoding"/>
                    <property name="disableTransportTransformer"/>
                    <property name="mimeType"/>
                    <property name="responseTimeout"/>
                    <property name="followRedirects"/>
                    <property name="connector-ref"/>
                    <property name="ref"/>
                    <property name="transformer-refs"/>
                    <property name="responseTransformer-refs"/>
                    <property name="user"/>
                    <property name="password"/>
                    <property name="contentType"/>
                    <property name="keep-alive"/>
                </properties>
            </endpoint>
            <splitter type="org.mule.tooling.ui.modules.core.pattern.cbr" name="Choice" entity-id="4d26b2ba-6819-4d92-9afb-38a92dd60fc2">
                <properties>
                    <property-collection name="d21d05a1-99f6-4dba-89ed-b06f9a9235f2">
                        <property value="#[ diffDays(message.inboundProperties['http.query.params']['date']) &lt; 30]" name="choice.expression"/>
                    </property-collection>
                    <property-collection name="d0adba11-da43-4760-9095-c2d15dab49b5">
                        <property value="true" name="choice.otherwise"/>
                    </property-collection>
                </properties>
                <pattern type="org.mule.tooling.ui.modules.core.pattern.cbr" name="Choice" entity-id="2f949c1f-8189-409f-99a7-404c4c3e902d"/>
                <compartment entity-id="86d9d541-1e55-4291-a4cf-1077c90b91ac">
                    <lane hadOnlyOneElement="false" entity-id="d21d05a1-99f6-4dba-89ed-b06f9a9235f2">
                        <pattern type="http://www.mulesoft.org/schema/mule/core/set-payload" name="Set Rate 0.2" entity-id="a1c28fb1-4897-4819-ade2-989cb4b3bfe4">
                            <properties>
<property value="0.2" name="value"/>
                            </properties>
                        </pattern>
                    </lane>
                    <lane hadOnlyOneElement="false" entity-id="d0adba11-da43-4760-9095-c2d15dab49b5">
                        <pattern type="http://www.mulesoft.org/schema/mule/core/set-payload" name="Set Rate 0.1" entity-id="70683c09-51f8-4d11-9b01-bd98f8fe0dc2">
                            <properties>
<property value="0.1" name="value"/>
                            </properties>
                        </pattern>
                    </lane>
                </compartment>
            </splitter>
        </lane>
    </flow>
    <flow SubFlow="false" name="databaseInitialisation">
        <properties>
            <property name="processingStrategy2"/>
            <property name="processingStrategy"/>
            <property name="bussinessEventsLabel"/>
            <property name="tracking:enable-default-events"/>
            <property name="USE_TRANSACTION_ID"/>
            <property name="tracking:transaction-id"/>
        </properties>
        <lane hadOnlyOneElement="false" entity-id="e4fb4b61-0f4f-4a31-91aa-993a7aa519fa">
            <endpoint message-exchange-pattern="OneWay" direction="Inbound" type="http://www.mulesoft.org/schema/mule/http/endpoint" name="HTTP" entity-id="639758b1-db1f-438b-9385-0d9fafee0679">
                <properties>
                    <property value="one-way" name="exchange-pattern"/>
                    <property value="request-response" name="exchange-pattern"/>
                    <property value="http://www.mulesoft.org/schema/mule/http/endpoint" name="org.mule.tooling.ui.modules.core.widgets.meta.ModeAttribute"/>
                    <property name="httpLabel"/>
                    <property value="localhost" name="host"/>
                    <property value="8787" name="port"/>
                    <property value="populate" name="path"/>
                    <property name="method"/>
                    <property name="businessEventsLabel"/>
                    <property name="tracking:enable-default-events"/>
                    <property name="address"/>
                    <property name="encoding"/>
                    <property name="disableTransportTransformer"/>
                    <property name="mimeType"/>
                    <property name="responseTimeout"/>
                    <property name="followRedirects"/>
                    <property name="connector-ref"/>
                    <property name="ref"/>
                    <property name="transformer-refs"/>
                    <property name="responseTransformer-refs"/>
                    <property name="user"/>
                    <property name="password"/>
                    <property name="contentType"/>
                    <property name="keep-alive"/>
                </properties>
            </endpoint>
            <pattern type="http://www.mulesoft.org/schema/mule/scripting/groovyComponent" name="Initialise Database" entity-id="389f1dd9-7dca-44d6-990b-49adce2d9a3d">
                <properties>
                    <property-collection name="@http://www.mulesoft.org/schema/mule/scripting/script;0">
                        <property value="jdbcConnector = muleContext.getRegistry().lookupConnector(&quot;JDBCConnector&quot;);&#xA;qr = jdbcConnector.getQueryRunner();&#xA;conn = jdbcConnector.getConnection();&#xA;qr.update(conn, &quot;CREATE TABLE credit_cards (i int generated always as identity, user_id varchar(256), cc_number varchar(256), expiration_date date, security_code varchar(256))&quot;);&#xA;&#xA;qr.update(conn, &quot;insert into credit_cards (user_id, cc_number, expiration_date, security_code) values('1','1234567890123456',date('2015-01-01'),'123')&quot;);&#xA;qr.update(conn, &quot;insert into credit_cards (user_id, cc_number, expiration_date, security_code) values('2','1234567890123456',date('2015-01-01'),'123')&quot;);&#xA;qr.update(conn, &quot;insert into credit_cards (user_id, cc_number, expiration_date, security_code) values('3','1234567890123456',date('2015-01-01'),'123')&quot;);&#xA;return &quot;db populated&quot;;" name="text"/>
                        <property value="Groovy" name="engine"/>
                    </property-collection>
                </properties>
            </pattern>
            <scope type="http://www.mulesoft.org/schema/mule/core/catch-exception-strategy" name="Catch Exception Strategy" entity-id="b4d6abd1-99d0-4ab5-a8ae-0fa10bf2a6da">
                <properties>
                    <property name=""/>
                    <property name="when"/>
                    <property name="enableNotifications"/>
                </properties>
                <compartment entity-id="467891db-9455-4244-a684-4b30f1f2b7ae">
                    <lane hadOnlyOneElement="false" entity-id="57e05463-c4f2-47ca-a46f-fb724db7c667">
                        <pattern type="http://www.mulesoft.org/schema/mule/core/expression-transformer" name="&quot;table already populated&quot;" entity-id="25cb833d-3dc3-4816-9a2f-99253f9bff8f">
                            <properties>
<property name="returnClass"/>
<property name="ignoreBadInput"/>
<property name="encoding"/>
<property name="mimeType"/>
<property value="table already populated" name="expression"/>
<property name="returnSourceIfNull"/>
                            </properties>
                        </pattern>
                    </lane>
                </compartment>
            </scope>
        </lane>
    </flow>
    <flow SubFlow="true" name="confirmFlight">
        <properties>
            <property name="processingStrategy2"/>
            <property name="processingStrategy"/>
            <property name="bussinessEventsLabel"/>
            <property name="tracking:enable-default-events"/>
            <property name="USE_TRANSACTION_ID"/>
            <property name="tracking:transaction-id"/>
        </properties>
        <lane hadOnlyOneElement="false" entity-id="21624c50-5ace-46be-891a-b12e8939c689">
            <pattern type="http://www.mulesoft.org/schema/mule/core/expression-transformer" name="Expression" entity-id="10f12e7c-298d-42eb-9524-aedbe94283af">
                <properties>
                    <property name="returnClass"/>
                    <property name="ignoreBadInput"/>
                    <property name="encoding"/>
                    <property name="mimeType"/>
                    <property value="#[request = new FlightConfirmationRequest(); request.setReservationNumber(flightReservationResponse.reservationNumber); request.setCreditCardAuthorisationNumber(paymentResponse.authorisationNumber); request]" name="expression"/>
                    <property name="returnSourceIfNull"/>
                </properties>
            </pattern>
            <pattern type="http://www.mulesoft.org/schema/mule/cxf/soapComponent" name="AirlineService" entity-id="1a0c00d3-349a-4d62-9a4d-e301c43e80c4">
                <properties>
                    <property name="configuration-ref"/>
                    <property value="http://www.mulesoft.org/schema/mule/cxf/jaxws-client" name="org.mule.tooling.ui.modules.core.widgets.meta.ModeAttribute"/>
                    <property value="confirmFlight" name="operation"/>
                    <property name="serviceClass"/>
                    <property name="decoupledEndpoint"/>
                    <property value="com.mule_air.airline.AirlineService_Service" name="clientClass"/>
                    <property value="AirlineSOAP" name="port"/>
                    <property name="mtomEnabled"/>
                    <property name="wsdlLocation"/>
                    <property name="enableMuleSoapHeaders"/>
                </properties>
            </pattern>
            <endpoint message-exchange-pattern="OneWay" direction="Outbound" type="http://www.mulesoft.org/schema/mule/http/endpoint" name="/reservations" entity-id="0f9709b4-792d-401c-af63-51f5a6f7fb12">
                <properties>
                    <property value="one-way" name="exchange-pattern"/>
                    <property value="request-response" name="exchange-pattern"/>
                    <property value="http://www.mulesoft.org/schema/mule/http/endpoint" name="org.mule.tooling.ui.modules.core.widgets.meta.ModeAttribute"/>
                    <property name="httpLabel"/>
                    <property value="localhost" name="host"/>
                    <property value="9090" name="port"/>
                    <property value="reservations" name="path"/>
                    <property name="method"/>
                    <property name="businessEventsLabel"/>
                    <property name="tracking:enable-default-events"/>
                    <property name="address"/>
                    <property name="encoding"/>
                    <property name="disableTransportTransformer"/>
                    <property name="mimeType"/>
                    <property name="responseTimeout"/>
                    <property name="followRedirects"/>
                    <property name="connector-ref"/>
                    <property name="ref"/>
                    <property name="transformer-refs"/>
                    <property name="responseTransformer-refs"/>
                    <property name="user"/>
                    <property name="password"/>
                    <property name="contentType"/>
                    <property name="keep-alive"/>
                </properties>
            </endpoint>
        </lane>
    </flow>
    <flow SubFlow="true" name="confirmHotelRoom">
        <properties>
            <property name="processingStrategy2"/>
            <property name="processingStrategy"/>
            <property name="bussinessEventsLabel"/>
            <property name="tracking:enable-default-events"/>
            <property name="USE_TRANSACTION_ID"/>
            <property name="tracking:transaction-id"/>
        </properties>
        <lane hadOnlyOneElement="false" entity-id="abcb3ead-15ce-479d-9202-758bdc9e0c4f">
            <pattern type="http://www.mulesoft.org/schema/mule/ee/data-mapper/data-mapper-connector" name="TravelRequest to ConfirmationRequest" entity-id="364f22d3-c266-4eab-8906-77f83e43d43d">
                <properties>
                    <property value="TravelRequest to ConfirmationRequest" name="config-ref"/>
                    <property value="http://www.mulesoft.org/schema/mule/ee/data-mapper/transform" name="org.mule.tooling.ui.modules.core.widgets.meta.ModeAttribute"/>
                    <property value="TravelRequest to ConfirmationRequest" name="config-ref"/>
                    <property name="input-ref"/>
                    <property-collection name="@http://www.mulesoft.org/schema/mule/ee/data-mapper/input-arguments;0">
                        <property-collection name="@http://www.mulesoft.org/schema/mule/ee/data-mapper/input-argument;1">
                            <property value="#[suitableRoom.id]" name="value"/>
                            <property value="roomId" name="key"/>
                        </property-collection>
                    </property-collection>
                </properties>
            </pattern>
            <pattern type="http://www.mulesoft.org/schema/mule/cxf/soapComponent" name="HotelService" entity-id="730a147a-332c-4752-9b35-6b03a2ff6209">
                <properties>
                    <property name="configuration-ref"/>
                    <property value="http://www.mulesoft.org/schema/mule/cxf/jaxws-client" name="org.mule.tooling.ui.modules.core.widgets.meta.ModeAttribute"/>
                    <property value="confirmRoom" name="operation"/>
                    <property name="serviceClass"/>
                    <property name="decoupledEndpoint"/>
                    <property value="com.mule_hotel.hotelservice.HotelService_Service" name="clientClass"/>
                    <property value="HotelServiceSOAP" name="port"/>
                    <property name="mtomEnabled"/>
                    <property name="wsdlLocation"/>
                    <property name="enableMuleSoapHeaders"/>
                </properties>
            </pattern>
            <endpoint message-exchange-pattern="OneWay" direction="Outbound" type="http://www.mulesoft.org/schema/mule/http/endpoint" name="/reservations" entity-id="1f782eca-6b3d-4317-94e0-a7a6ace41eac">
                <properties>
                    <property value="one-way" name="exchange-pattern"/>
                    <property value="request-response" name="exchange-pattern"/>
                    <property value="http://www.mulesoft.org/schema/mule/http/endpoint" name="org.mule.tooling.ui.modules.core.widgets.meta.ModeAttribute"/>
                    <property name="httpLabel"/>
                    <property value="localhost" name="host"/>
                    <property value="9595" name="port"/>
                    <property value="reservations" name="path"/>
                    <property name="method"/>
                    <property name="businessEventsLabel"/>
                    <property name="tracking:enable-default-events"/>
                    <property name="address"/>
                    <property name="encoding"/>
                    <property name="disableTransportTransformer"/>
                    <property name="mimeType"/>
                    <property name="responseTimeout"/>
                    <property name="followRedirects"/>
                    <property name="connector-ref"/>
                    <property name="ref"/>
                    <property name="transformer-refs"/>
                    <property name="responseTransformer-refs"/>
                    <property name="user"/>
                    <property name="password"/>
                    <property name="contentType"/>
                    <property name="keep-alive"/>
                </properties>
            </endpoint>
        </lane>
    </flow>
    <flow SubFlow="true" name="authorisePayment">
        <properties>
            <property name="processingStrategy2"/>
            <property name="processingStrategy"/>
            <property name="bussinessEventsLabel"/>
            <property name="tracking:enable-default-events"/>
            <property name="USE_TRANSACTION_ID"/>
            <property name="tracking:transaction-id"/>
        </properties>
        <lane hadOnlyOneElement="false" entity-id="11aa70d1-6bdd-461a-9a15-a2447ffdeb39">
            <scope type="org.mule.tooling.ui.modules.core.scope.enricher" name="Enrich with creditCard" entity-id="82e0560e-c652-4b56-b327-d8640fbf46c9">
                <properties>
                    <property value="payload[0]" name="source"/>
                    <property value="#[variable:creditCard]" name="target"/>
                </properties>
                <compartment entity-id="c9c79977-57bf-41d8-99c7-eb18f2c32d3f">
                    <lane hadOnlyOneElement="false" entity-id="282b8909-abe7-4b17-a7b0-ddeef72d6d7a">
                        <endpoint message-exchange-pattern="OneWay" direction="Outbound" type="http://www.mulesoft.org/schema/mule/ee/jdbc/endpoint" name="Select * from credit_cards" entity-id="939c2523-090e-4c6c-8a22-3c97c38efc92">
                            <properties>
<property value="one-way" name="exchange-pattern"/>
<property value="request-response" name="exchange-pattern"/>
<property name=""/>
<property value="findCreditCard" name="queryKey"/>
<property name="businessEventsLabel"/>
<property name="tracking:enable-default-events"/>
<property name="address"/>
<property name="responseTimeout"/>
<property name="encoding"/>
<property name="disableTransportTransformer"/>
<property name="mimeType"/>
<property value="-1" name="queryTimeout"/>
<property name="pollingFrequency"/>
<property value="JDBCConnector" name="connector-ref"/>
<property name="ref"/>
<property name="transformer-refs"/>
<property name="responseTransformer-refs"/>
<property-collection name="@http://www.mulesoft.org/schema/mule/ee/jdbc/query;0">
    <property value="select cc_number, expiration_date, security_code from credit_cards where user_id = #[payload.userId]" name="value"/>
    <property value="findCreditCard" name="key"/>
</property-collection>
                            </properties>
                        </endpoint>
                    </lane>
                </compartment>
            </scope>
            <pattern type="http://www.mulesoft.org/schema/mule/core/expression-transformer" name="Expression" entity-id="e7877503-4269-4f03-b042-f4884de5590a">
                <properties>
                    <property name="returnClass"/>
                    <property name="ignoreBadInput"/>
                    <property name="encoding"/>
                    <property name="mimeType"/>
                    <property value="#[request = new com.mule_credit.creditcardservice.PaymentRequest(); request.setAmount(Float.valueOf(price)); request.setCcNumber(creditCard.cc_number); request.setExpirationDate(creditCard.expiration_date); request.setSecurityCode(creditCard.security_code); request]" name="expression"/>
                    <property name="returnSourceIfNull"/>
                </properties>
            </pattern>
            <pattern type="http://www.mulesoft.org/schema/mule/cxf/soapComponent" name="CreditCardService" entity-id="0d02703a-c4d8-40a6-aa1c-33c70f001fd8">
                <properties>
                    <property name="configuration-ref"/>
                    <property value="http://www.mulesoft.org/schema/mule/cxf/jaxws-client" name="org.mule.tooling.ui.modules.core.widgets.meta.ModeAttribute"/>
                    <property value="authorisePayment" name="operation"/>
                    <property name="serviceClass"/>
                    <property name="decoupledEndpoint"/>
                    <property value="com.mule_credit.creditcardservice.CreditCardService_Service" name="clientClass"/>
                    <property value="CreditCardServiceSOAP" name="port"/>
                    <property name="mtomEnabled"/>
                    <property name="wsdlLocation"/>
                    <property name="enableMuleSoapHeaders"/>
                </properties>
            </pattern>
            <endpoint message-exchange-pattern="OneWay" direction="Outbound" type="http://www.mulesoft.org/schema/mule/http/endpoint" name="/authorisations" entity-id="4cd3bc9b-7948-441a-864c-53b31ca68216">
                <properties>
                    <property value="one-way" name="exchange-pattern"/>
                    <property value="request-response" name="exchange-pattern"/>
                    <property value="http://www.mulesoft.org/schema/mule/http/endpoint" name="org.mule.tooling.ui.modules.core.widgets.meta.ModeAttribute"/>
                    <property name="httpLabel"/>
                    <property value="localhost" name="host"/>
                    <property value="9999" name="port"/>
                    <property value="authorisations" name="path"/>
                    <property name="method"/>
                    <property name="businessEventsLabel"/>
                    <property name="tracking:enable-default-events"/>
                    <property name="address"/>
                    <property name="encoding"/>
                    <property name="disableTransportTransformer"/>
                    <property name="mimeType"/>
                    <property name="responseTimeout"/>
                    <property name="followRedirects"/>
                    <property name="connector-ref"/>
                    <property name="ref"/>
                    <property name="transformer-refs"/>
                    <property name="responseTransformer-refs"/>
                    <property name="user"/>
                    <property name="password"/>
                    <property name="contentType"/>
                    <property name="keep-alive"/>
                </properties>
            </endpoint>
        </lane>
    </flow>
    <flow SubFlow="true" name="cancelFlight">
        <properties>
            <property name="processingStrategy2"/>
            <property name="processingStrategy"/>
            <property name="bussinessEventsLabel"/>
            <property name="tracking:enable-default-events"/>
            <property name="USE_TRANSACTION_ID"/>
            <property name="tracking:transaction-id"/>
        </properties>
        <lane hadOnlyOneElement="false" entity-id="99b4c5d5-a99a-4489-89d3-885d9d1a8d74">
            <pattern type="http://www.mulesoft.org/schema/mule/core/expression-transformer" name="Expression" entity-id="ccfba89f-df73-4293-8baa-292d99504dd8">
                <properties>
                    <property name="returnClass"/>
                    <property name="ignoreBadInput"/>
                    <property name="encoding"/>
                    <property name="mimeType"/>
                    <property value="#[request = new com.mule_air.airline.CancelationRequest(); request.setConfirmationNumber(flightConfirmationResponse.confirmationNumber); request]" name="expression"/>
                    <property name="returnSourceIfNull"/>
                </properties>
            </pattern>
            <pattern type="http://www.mulesoft.org/schema/mule/cxf/soapComponent" name="AirlineService" entity-id="c32687af-e763-45f4-8e5f-491f5a3a7d76">
                <properties>
                    <property name="configuration-ref"/>
                    <property value="http://www.mulesoft.org/schema/mule/cxf/jaxws-client" name="org.mule.tooling.ui.modules.core.widgets.meta.ModeAttribute"/>
                    <property value="cancelFlight" name="operation"/>
                    <property name="serviceClass"/>
                    <property name="decoupledEndpoint"/>
                    <property value="com.mule_air.airline.AirlineService_Service" name="clientClass"/>
                    <property value="AirlineSOAP" name="port"/>
                    <property name="mtomEnabled"/>
                    <property name="wsdlLocation"/>
                    <property name="enableMuleSoapHeaders"/>
                </properties>
            </pattern>
            <endpoint message-exchange-pattern="OneWay" direction="Outbound" type="http://www.mulesoft.org/schema/mule/http/endpoint" name="/reservations" entity-id="7c8d3bf0-9096-47af-b2e7-408e308ff139">
                <properties>
                    <property value="one-way" name="exchange-pattern"/>
                    <property value="request-response" name="exchange-pattern"/>
                    <property value="http://www.mulesoft.org/schema/mule/http/endpoint" name="org.mule.tooling.ui.modules.core.widgets.meta.ModeAttribute"/>
                    <property name="httpLabel"/>
                    <property value="localhost" name="host"/>
                    <property value="9090" name="port"/>
                    <property value="reservations" name="path"/>
                    <property name="method"/>
                    <property name="businessEventsLabel"/>
                    <property name="tracking:enable-default-events"/>
                    <property name="address"/>
                    <property name="encoding"/>
                    <property name="disableTransportTransformer"/>
                    <property name="mimeType"/>
                    <property name="responseTimeout"/>
                    <property name="followRedirects"/>
                    <property name="connector-ref"/>
                    <property name="ref"/>
                    <property name="transformer-refs"/>
                    <property name="responseTransformer-refs"/>
                    <property name="user"/>
                    <property name="password"/>
                    <property name="contentType"/>
                    <property name="keep-alive"/>
                </properties>
            </endpoint>
        </lane>
    </flow>
    <flow SubFlow="true" name="cancelPayment">
        <properties>
            <property name="processingStrategy2"/>
            <property name="processingStrategy"/>
            <property name="bussinessEventsLabel"/>
            <property name="tracking:enable-default-events"/>
            <property name="USE_TRANSACTION_ID"/>
            <property name="tracking:transaction-id"/>
        </properties>
        <lane hadOnlyOneElement="false" entity-id="68a0b59c-de76-4754-b2f6-833051049fb4">
            <pattern type="http://www.mulesoft.org/schema/mule/core/expression-transformer" name="Expression" entity-id="e5449e5a-4e2b-4b22-8e4e-85746320d0e5">
                <properties>
                    <property name="returnClass"/>
                    <property name="ignoreBadInput"/>
                    <property name="encoding"/>
                    <property name="mimeType"/>
                    <property value="#[request = new com.mule_credit.creditcardservice.CancelationRequest(); request.setConfirmationNumber(paymentResponse.confirmationNumber); request]" name="expression"/>
                    <property name="returnSourceIfNull"/>
                </properties>
            </pattern>
            <pattern type="http://www.mulesoft.org/schema/mule/cxf/soapComponent" name="CreditCardService" entity-id="2f0fdeaa-55ec-4905-a228-b4e47b41b2d5">
                <properties>
                    <property name="configuration-ref"/>
                    <property value="http://www.mulesoft.org/schema/mule/cxf/jaxws-client" name="org.mule.tooling.ui.modules.core.widgets.meta.ModeAttribute"/>
                    <property value="cancelPayment" name="operation"/>
                    <property name="serviceClass"/>
                    <property name="decoupledEndpoint"/>
                    <property value="com.mule_credit.creditcardservice.CreditCardService_Service" name="clientClass"/>
                    <property value="CreditCardServiceSOAP" name="port"/>
                    <property name="mtomEnabled"/>
                    <property name="wsdlLocation"/>
                    <property name="enableMuleSoapHeaders"/>
                </properties>
            </pattern>
            <endpoint message-exchange-pattern="OneWay" direction="Outbound" type="http://www.mulesoft.org/schema/mule/http/endpoint" name="/authorisations" entity-id="d133da42-3b53-4276-96b2-a9065dde2fbd">
                <properties>
                    <property value="one-way" name="exchange-pattern"/>
                    <property value="request-response" name="exchange-pattern"/>
                    <property value="http://www.mulesoft.org/schema/mule/http/endpoint" name="org.mule.tooling.ui.modules.core.widgets.meta.ModeAttribute"/>
                    <property name="httpLabel"/>
                    <property value="localhost" name="host"/>
                    <property value="9999" name="port"/>
                    <property value="authorisations" name="path"/>
                    <property name="method"/>
                    <property name="businessEventsLabel"/>
                    <property name="tracking:enable-default-events"/>
                    <property name="address"/>
                    <property name="encoding"/>
                    <property name="disableTransportTransformer"/>
                    <property name="mimeType"/>
                    <property name="responseTimeout"/>
                    <property name="followRedirects"/>
                    <property name="connector-ref"/>
                    <property name="ref"/>
                    <property name="transformer-refs"/>
                    <property name="responseTransformer-refs"/>
                    <property name="user"/>
                    <property name="password"/>
                    <property name="contentType"/>
                    <property name="keep-alive"/>
                </properties>
            </endpoint>
        </lane>
    </flow>
    <description></description>
</mule-configuration>
